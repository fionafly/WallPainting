const cocoData = {
    "info": {
        "description": 
        "coco from ISAT", 
        "version": null, 
        "year": null, 
        "contributor": null, 
        "date_created": null}, 
        "licenses": [{
            "url": null, 
            "id": 0, 
            "name": null}], 
            "images": [{
                "license": "", 
                "url": "", 
                "file_name": "p69.png", 
                "height": 2396, 
                "width": 1739, 
                "date_captured": "", 
                "id": 0}], 
                "annotations": [{
                    "iscrowd": false, 
                    "image_id": 0, 
                    "image_name": "p69.png", 
                    "category_id": 1, 
                    "id": 0, 
                    "segmentation": [[774.02, 1790.6, 755.45, 1824.55, 761.11, 1856.41, 777.4, 1875.53, 785.9, 1886.86, 796.52, 1905.26, 736.33, 1951.29, 715.09, 1981.73, 698.81, 2014.3, 703.77, 2031.29, 715.8, 2041.2, 740.58, 2032.71, 756.16, 2023.5, 768.9, 2009.34, 778.11, 2000.14, 783.77, 2012.17, 781.65, 2053.95, 775.28, 2081.56, 766.07, 2099.97, 755.45, 2124.75, 744.12, 2158.03, 746.25, 2180.68, 761.11, 2211.83, 766.78, 2238.03, 778.11, 2272.02, 807.14, 2279.1, 810.68, 2315.2, 811.38, 2354.15, 819.88, 2368.31, 834.75, 2394.5, 844.66, 2390.96, 843.24, 2364.06, 860.94, 2330.78, 863.07, 2320.16, 889.97, 2319.45, 926.79, 2322.99, 960.07, 2339.28, 998.3, 2349.19, 1045.74, 2354.15, 1091.76, 2354.85, 1098.84, 2350.61, 1113.71, 2336.45, 1114.41, 2324.41, 1112.29, 2310.25, 1108.75, 2296.09, 1100.96, 2276.26, 1097.42, 2264.23, 1080.43, 2086.52, 1072.64, 2065.28, 1059.9, 2056.07, 1039.36, 2061.03, 1021.66, 2063.86, 1008.21, 2037.66, 994.76, 1983.85, 994.05, 1915.18, 975.64, 1857.12, 986.97, 1704.19, 1022.37, 1715.52, 1042.2, 1768.62, 1037.91, 1813.75, 1029.45, 1845.79, 1013.17, 1859.24, 1020.96, 1882.61, 1038.66, 1862.78, 1054.94, 1828.8, 1063.44, 1781.36, 1062.73, 1758.71, 1052.11, 1717.64, 1041.49, 1692.86, 1015.07, 1684.66, 995.32, 1668.82, 939.53, 1617.1, 880.77, 1593.74, 836.16, 1597.28, 807.14, 1615.69, 792.98, 1646.84, 781.65, 1671.62, 756.16, 1688.61, 746.25, 1694.98, 711.55, 1702.06, 699.52, 1714.1, 703.76, 1727.57, 728.55, 1725.43, 739.87, 1716.23, 759.7, 1707.73, 776.69, 1702.77, 787.31, 1693.57, 792.27, 1687.2, 802.84, 1666.06, 839.7, 1618.52, 868.02, 1611.44, 907.67, 1638.34, 931.75, 1656.75, 965.02, 1694.28, 947.32, 1788.44, 929.62, 1833.05, 922.54, 1841.54, 906.26, 1813.22, 887.85, 1782.78, 868.73, 1767.91, 818.46, 1771.45, 801.49, 1773.2, 788.98, 1777.4]], 
                    "area": 172420.5479993919, 
                    "bbox": [698.3295440722582, 1593.2404565708375, 416.5831922731279, 801.7328237592023],
                    "description": '追捕的士兵'
                }, 
                    {"iscrowd": false, 
                        "image_id": 0, 
                        "image_name": "p69.png", 
                        "category_id": 2, 
                        "id": 1, 
                        "segmentation": [[700.81, 1269.04, 613.64, 1261.17, 537.03, 1341.05, 556.0, 1501.0, 558.0, 1528.0, 566.0, 1528.0, 585.0, 1559.0, 634.0, 1609.0, 699.0, 1644.0, 744.0, 1662.0, 759.78, 1664.3, 772.58, 1668.69, 789.1, 1678.65, 794.0, 1679.0, 819.0, 1674.0, 830.0, 1683.0, 855.0, 1687.0, 893.0, 1703.0, 949.0, 1711.0, 961.0, 1709.0, 971.0, 1713.0, 986.0, 1710.0, 996.0, 1702.0, 1048.0, 1712.0, 1092.0, 1707.0, 1119.0, 1700.0, 1129.0, 1687.0, 1154.0, 1680.0, 1165.0, 1669.0, 1202.0, 1651.0, 1266.0, 1636.0, 1297.0, 1617.0, 1315.0, 1616.0, 1300.0, 1594.0, 1302.0, 1587.0, 1299.0, 1580.0, 1282.0, 1575.0, 1241.0, 1575.0, 1213.0, 1591.0, 1201.0, 1593.0, 1193.0, 1601.0, 1098.0, 1607.0, 1064.0, 1599.0, 1036.0, 1581.0, 979.0, 1557.0, 941.0, 1552.0, 909.0, 1542.0, 827.0, 1539.0, 781.0, 1522.0, 772.0, 1514.0, 748.0, 1479.0, 747.0, 1446.0, 755.0, 1433.0, 778.0, 1416.0, 783.0, 1388.0, 790.0, 1372.0, 779.0, 1351.0, 762.0, 1333.0, 736.0, 1313.0, 673.17, 1328.37, 591.45, 1450.52, 583.76, 1389.71, 643.87, 1280.36, 661.71, 1296.06, 716.94, 1291.31]], 
                        "area": 124092.17907765525, 
                        "bbox": [536.5380651964609, 1260.6673528750987, 778.8750484749429, 452.8229374627467],
                        "description": '猴王双脚用藤蔓缚于河边树上，双手抱住对岸的树'
                    }, 
                        {"iscrowd": false, 
                            "image_id": 0, 
                            "image_name": "p69.png", 
                            "category_id": 2, 
                            "id": 2, 
                            "segmentation": [[743.72, 1133.23, 732.26, 1141.88, 727.1, 1153.73, 726.21, 1166.23, 725.63, 1173.47, 724.1, 1185.33, 726.72, 1195.23, 728.72, 1203.23, 727.72, 1230.23, 734.72, 1244.23, 734.72, 1253.23, 741.72, 1274.23, 760.72, 1295.23, 779.72, 1310.23, 779.72, 1320.23, 782.72, 1327.23, 777.72, 1334.23, 777.72, 1345.23, 774.72, 1350.23, 776.72, 1365.23, 783.72, 1375.23, 797.72, 1384.23, 847.72, 1392.23, 860.27, 1393.98, 873.72, 1393.23, 881.72, 1391.23, 919.76, 1364.78, 952.9, 1366.34, 907.68, 1413.45, 897.76, 1433.08, 900.79, 1450.83, 893.36, 1465.04, 889.7, 1475.22, 883.67, 1480.91, 877.79, 1488.26, 871.33, 1494.31, 859.95, 1512.8, 852.08, 1520.1, 845.72, 1529.23, 828.23, 1543.12, 842.94, 1546.09, 854.72, 1543.23, 889.72, 1538.23, 896.72, 1532.23, 908.72, 1506.23, 932.72, 1476.23, 950.78, 1445.84, 982.14, 1426.64, 1011.63, 1426.3, 1042.09, 1427.14, 1069.15, 1437.87, 1075.53, 1450.94, 1074.21, 1464.96, 1074.85, 1468.2, 1073.65, 1470.45, 1075.75, 1472.56, 1076.02, 1474.38, 1078.78, 1480.66, 1081.84, 1485.47, 1086.52, 1489.77, 1098.03, 1504.74, 1112.59, 1513.16, 1195.57, 1569.62, 1169.25, 1586.42, 1170.01, 1604.15, 1196.08, 1597.76, 1245.71, 1577.28, 1164.57, 1507.23, 1153.18, 1498.24, 1140.88, 1478.18, 1134.29, 1458.6, 1123.09, 1380.53, 1109.67, 1349.36, 1098.82, 1331.4, 1086.66, 1318.21, 1072.88, 1308.76, 1057.79, 1299.76, 1034.03, 1277.94, 1021.08, 1270.57, 1002.94, 1259.52, 991.05, 1254.39, 977.49, 1244.44, 930.72, 1236.23, 919.72, 1237.23, 916.72, 1233.23, 920.72, 1218.23, 918.72, 1207.23, 904.72, 1197.23, 896.72, 1183.23, 866.72, 1168.23, 853.72, 1167.23, 829.72, 1176.23, 817.72, 1188.23, 804.44, 1214.27, 814.19, 1273.43, 764.2, 1247.32, 746.47, 1174.45, 779.72, 1149.23, 775.56, 1129.48, 766.65, 1117.65, 752.29, 1122.93]], 
                            "area": 77335.68676764128, 
                            "bbox": [723.6029219843117, 1117.1839297190331, 522.4357829431217, 487.45470922063623],
                            "description": '在猕猴王身上行走的猴子'
                        }, 
                            {"iscrowd": false, 
                                "image_id": 0, 
                                "image_name": "p69.png", 
                                "category_id": 2, 
                                "id": 3, 
                                "segmentation": [[1165.0, 1189.0, 1154.0, 1199.0, 1146.0, 1214.0, 1142.0, 1244.0, 1142.0, 1262.0, 1146.0, 1276.0, 1157.0, 1289.0, 1169.0, 1294.0, 1177.0, 1304.0, 1170.0, 1323.0, 1165.0, 1350.0, 1167.0, 1373.0, 1163.0, 1389.0, 1163.0, 1419.0, 1159.0, 1433.0, 1157.0, 1469.0, 1154.0, 1478.0, 1157.0, 1492.0, 1164.0, 1496.0, 1169.0, 1494.0, 1182.0, 1465.0, 1189.0, 1439.0, 1189.0, 1419.0, 1200.0, 1356.0, 1199.0, 1332.0, 1204.0, 1327.0, 1211.0, 1327.0, 1220.0, 1334.0, 1243.0, 1343.0, 1253.0, 1353.0, 1253.0, 1363.0, 1246.0, 1370.0, 1240.0, 1386.0, 1241.0, 1400.0, 1235.0, 1415.0, 1234.0, 1438.0, 1229.0, 1454.0, 1229.39, 1483.59, 1223.8, 1500.57, 1221.05, 1510.4, 1219.61, 1521.55, 1217.82, 1528.8, 1217.56, 1535.32, 1218.13, 1551.05, 1221.02, 1565.4, 1240.08, 1557.9, 1235.0, 1521.0, 1247.0, 1504.0, 1265.0, 1494.0, 1295.0, 1487.0, 1353.0, 1506.0, 1357.0, 1512.0, 1363.86, 1516.98, 1369.45, 1519.0, 1379.31, 1530.69, 1386.63, 1533.61, 1390.18, 1535.47, 1394.92, 1537.72, 1409.0, 1538.0, 1425.1, 1559.8, 1429.0, 1547.0, 1436.0, 1541.0, 1429.69, 1534.86, 1424.0, 1523.0, 1410.0, 1514.0, 1400.0, 1513.0, 1397.0, 1510.0, 1391.1, 1513.17, 1386.38, 1501.19, 1379.79, 1496.15, 1374.07, 1485.6, 1357.05, 1466.51, 1368.84, 1458.0, 1373.0, 1453.0, 1392.0, 1433.0, 1412.0, 1421.0, 1422.0, 1409.0, 1427.0, 1395.0, 1425.0, 1353.0, 1407.0, 1307.0, 1393.0, 1295.0, 1357.0, 1249.0, 1319.0, 1220.0, 1306.0, 1217.0, 1277.0, 1202.0, 1258.0, 1202.0, 1241.0, 1211.0, 1233.0, 1211.0, 1212.0, 1195.0, 1189.0, 1184.0]], 
                                "area": 62972.271458941395, 
                                "bbox": [1141.5, 1183.3332051405303, 294.8485010474453, 382.5323481138332],
                                "description": '在猕猴王身上行走的猴子'
                            }], 
                                "categories": [{
                                    "name": "person", 
                                    "id": 1, 
                                    "supercategory": null}, 
                                    {"name": "monkey", 
                                        "id": 2, 
                                        "supercategory": null}]};




// 初始化画布
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const infoBox = document.getElementById('info-box');


// 加载图像
const img = new Image();
img.src = "p69.png";



// 图像加载完毕后执行
img.onload = () => {
    // 根据图片的宽高比调整画布尺寸
    const aspectRatio = img.width / img.height;
    canvas.width = canvas.clientWidth; // 使用 CSS 控制宽度
    canvas.height = canvas.width / aspectRatio; // 高度按照比例调整

    // 绘制图像
    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

    // 添加鼠标移动事件监听器
    canvas.addEventListener('mousemove', (event) => {
        const mouseX = event.offsetX;
        const mouseY = event.offsetY;

        let activeAnnotation = null;

        // 清除画布并重新绘制背景
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

        cocoData.annotations.forEach(annotation => {
            const segmentation = annotation.segmentation[0];
            ctx.beginPath();
            for (let i = 0; i < segmentation.length; i += 2) {
                const x = (segmentation[i] / cocoData.images[0].width) * canvas.width;
                const y = (segmentation[i + 1] / cocoData.images[0].height) * canvas.height;
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.closePath();

            // 高亮检测
            if (ctx.isPointInPath(mouseX, mouseY)) {
                ctx.fillStyle = 'rgba(255, 0, 0, 0.3)';
                activeAnnotation = annotation;
            } else {
                ctx.fillStyle = 'rgba(255, 0, 0, 0)';
            }
            ctx.fill();
        });

        // 显示注释信息
        if (activeAnnotation) {
            const infoBoxX = event.pageX + 10;
            const infoBoxY = event.pageY + 10;
            infoBox.style.left = `${infoBoxX}px`;
            infoBox.style.top = `${infoBoxY}px`;
            infoBox.textContent = activeAnnotation.description;
            infoBox.style.display = 'block';
        } else {
            infoBox.style.display = 'none';
        }
    });
};
